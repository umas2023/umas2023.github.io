<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="4.3.2">Jekyll</generator><link href="/feed.xml" rel="self" type="application/atom+xml" /><link href="/" rel="alternate" type="text/html" /><updated>2023-06-29T14:53:14+08:00</updated><id>/feed.xml</id><title type="html">umas’ awesome title</title><subtitle>umas&apos; awesome description for my new site here. It will appear in my document head meta (for Google search results) and in my feed.xml site description.</subtitle><entry><title type="html">bash: rpi_status 树莓派状态监控脚本</title><link href="/bash/init_rpi_status/" rel="alternate" type="text/html" title="bash: rpi_status 树莓派状态监控脚本" /><published>2023-06-29T14:45:00+08:00</published><updated>2023-06-29T14:45:00+08:00</updated><id>/bash/init_rpi_status</id><content type="html" xml:base="/bash/init_rpi_status/"><![CDATA[<ul>
  <li>简单介绍项目需求
    <ul>
      <li>略</li>
    </ul>
  </li>
  <li>sh脚本</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#! /bin/bash</span>

<span class="c"># ### - rpi_status.sh [显示树莓派状态：温度]</span>
<span class="c"># - 脚本调用  </span>
<span class="c"># ```./show.sh```</span>


<span class="k">while</span> <span class="o">[</span> <span class="nb">true</span> <span class="o">]</span><span class="p">;</span> <span class="k">do</span>

    <span class="c"># 输出时间</span>
    <span class="nb">date</span>

    <span class="c"># cpu温度</span>
    <span class="nv">get_temp</span><span class="o">=</span><span class="sb">`</span><span class="nb">cat</span> /sys/class/thermal/thermal_zone0/temp<span class="sb">`</span>
    <span class="nv">temprature</span><span class="o">=</span><span class="sb">`</span><span class="nb">echo</span> <span class="s2">"scale=3; </span><span class="nv">$get_temp</span><span class="s2">/1000"</span> | bc<span class="sb">`</span>
    <span class="nb">echo</span> <span class="s2">"temperature: </span><span class="nv">$temprature</span><span class="s2"> C"</span>

    <span class="c"># 网络监控</span>
    <span class="nb">cat</span> /proc/net/dev

    <span class="c"># cpu占用</span>
    

    <span class="c"># 内存占用</span>


    <span class="c"># 睡眠1秒，清屏</span>
    /bin/sleep 1
    clear
<span class="k">done</span>


</code></pre></div></div>]]></content><author><name></name></author><category term="bash" /><summary type="html"><![CDATA[简单介绍项目需求 略]]></summary></entry><entry><title type="html">bash: init_samba 一键部署samba局域网文件共享</title><link href="/bash/init_samba/" rel="alternate" type="text/html" title="bash: init_samba 一键部署samba局域网文件共享" /><published>2023-06-29T14:35:00+08:00</published><updated>2023-06-29T14:35:00+08:00</updated><id>/bash/init_samba</id><content type="html" xml:base="/bash/init_samba/"><![CDATA[<ul>
  <li>简单介绍项目需求
    <ul>
      <li>略</li>
    </ul>
  </li>
  <li>sh脚本</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#! /bin/bash</span>

<span class="c"># ### - init_samba [samba局域网文件共享]</span>
<span class="c"># - 脚本调用  </span>
<span class="c"># ```./setup.sh```</span>
<span class="c"># - 参数修改</span>
<span class="c">#     - 系统适配(ubuntu/raspbian)：/init_samba/setup.sh - 选择conf文件(line9)</span>
<span class="c">#     - 共享文件夹参数：/init_samba/smb.conf - [public] (line243)</span>


<span class="c"># 切换工作目录</span>
<span class="nb">cd</span> <span class="sb">`</span><span class="nb">dirname</span> <span class="nv">$0</span><span class="sb">`</span>


<span class="nv">package</span><span class="o">=</span><span class="s2">"samba"</span>
<span class="k">if  </span><span class="nb">type</span> <span class="nv">$package</span> <span class="o">&gt;</span> /dev/null 2&gt;&amp;1<span class="p">;</span><span class="k">then
    </span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$package</span><span class="s2"> already installed"</span>
<span class="k">else
    </span>apt update
    apt <span class="nb">install</span> <span class="nv">$package</span> <span class="nt">-y</span>
<span class="k">fi


</span><span class="nb">cp</span> /etc/samba/smb.conf /etc/samba/smb.conf.bk
<span class="c"># cp smb_ubuntu.conf /etc/samba/smb.conf</span>
<span class="nb">cp </span>smb_raspbian.conf /etc/samba/smb.conf
<span class="nb">printf</span> <span class="s2">"umas1970</span><span class="se">\n</span><span class="s2">umas1970"</span> | smbpasswd <span class="nt">-a</span> root
samba restart

</code></pre></div></div>

<ul>
  <li>准备了两个版本的conf文件，分别用于树莓派和ubuntu系统，虽然内容很多但实际只有最后面[public]部分是smb的设置</li>
  <li>smb_raspbian.conf</li>
</ul>

<div class="language-conf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#
# Sample configuration file for the Samba suite for Debian GNU/Linux.
#
#
# This is the main Samba configuration file. You should read the
# smb.conf(5) manual page in order to understand the options listed
# here. Samba has a huge number of configurable options most of which 
# are not shown in this example
#
# Some options that are often worth tuning have been included as
# commented-out examples in this file.
#  - When such options are commented with ";", the proposed setting
#    differs from the default Samba behaviour
#  - When commented with "#", the proposed setting is the default
#    behaviour of Samba but the option is considered important
#    enough to be mentioned here
#
# NOTE: Whenever you modify this file you should run the command
# "testparm" to check that you have not made any basic syntactic 
# errors. 
</span>
<span class="c">#======================= Global Settings =======================
</span>
[<span class="n">global</span>]

<span class="c">## Browsing/Identification ###
</span>
<span class="c"># Change this to the workgroup/NT-domain name your Samba server will part of
</span>   <span class="n">workgroup</span> = <span class="n">WORKGROUP</span>

<span class="c">#### Networking ####
</span>
<span class="c"># The specific set of interfaces / networks to bind to
# This can be either the interface name or an IP address/netmask;
# interface names are normally preferred
</span>;   <span class="n">interfaces</span> = <span class="m">127</span>.<span class="m">0</span>.<span class="m">0</span>.<span class="m">0</span>/<span class="m">8</span> <span class="n">eth0</span>

<span class="c"># Only bind to the named interfaces and/or networks; you must use the
# 'interfaces' option above to use this.
# It is recommended that you enable this feature if your Samba machine is
# not protected by a firewall or is a firewall itself.  However, this
# option cannot handle dynamic or non-broadcast interfaces correctly.
</span>;   <span class="n">bind</span> <span class="n">interfaces</span> <span class="n">only</span> = <span class="n">yes</span>



<span class="c">#### Debugging/Accounting ####
</span>
<span class="c"># This tells Samba to use a separate log file for each machine
# that connects
</span>   <span class="n">log</span> <span class="n">file</span> = /<span class="n">var</span>/<span class="n">log</span>/<span class="n">samba</span>/<span class="n">log</span>.%<span class="n">m</span>

<span class="c"># Cap the size of the individual log files (in KiB).
</span>   <span class="n">max</span> <span class="n">log</span> <span class="n">size</span> = <span class="m">1000</span>

<span class="c"># We want Samba to only log to /var/log/samba/log.{smbd,nmbd}.
# Append syslog@1 if you want important messages to be sent to syslog too.
</span>   <span class="n">logging</span> = <span class="n">file</span>

<span class="c"># Do something sensible when Samba crashes: mail the admin a backtrace
</span>   <span class="n">panic</span> <span class="n">action</span> = /<span class="n">usr</span>/<span class="n">share</span>/<span class="n">samba</span>/<span class="n">panic</span>-<span class="n">action</span> %<span class="n">d</span>


<span class="c">####### Authentication #######
</span>
<span class="c"># Server role. Defines in which mode Samba will operate. Possible
# values are "standalone server", "member server", "classic primary
# domain controller", "classic backup domain controller", "active
# directory domain controller". 
#
# Most people will want "standalone server" or "member server".
# Running as "active directory domain controller" will require first
# running "samba-tool domain provision" to wipe databases and create a
# new domain.
</span>   <span class="n">server</span> <span class="n">role</span> = <span class="n">standalone</span> <span class="n">server</span>

   <span class="n">obey</span> <span class="n">pam</span> <span class="n">restrictions</span> = <span class="n">yes</span>

<span class="c"># This boolean parameter controls whether Samba attempts to sync the Unix
# password with the SMB password when the encrypted SMB password in the
# passdb is changed.
</span>   <span class="n">unix</span> <span class="n">password</span> <span class="n">sync</span> = <span class="n">yes</span>

<span class="c"># For Unix password sync to work on a Debian GNU/Linux system, the following
# parameters must be set (thanks to Ian Kahan &lt;&lt;kahan@informatik.tu-muenchen.de&gt; for
# sending the correct chat script for the passwd program in Debian Sarge).
</span>   <span class="n">passwd</span> <span class="n">program</span> = /<span class="n">usr</span>/<span class="n">bin</span>/<span class="n">passwd</span> %<span class="n">u</span>
   <span class="n">passwd</span> <span class="n">chat</span> = *<span class="n">Enter</span>\<span class="n">snew</span>\<span class="n">s</span>*\<span class="n">spassword</span>:* %<span class="n">n</span>\<span class="n">n</span> *<span class="n">Retype</span>\<span class="n">snew</span>\<span class="n">s</span>*\<span class="n">spassword</span>:* %<span class="n">n</span>\<span class="n">n</span> *<span class="n">password</span>\<span class="n">supdated</span>\<span class="n">ssuccessfully</span>* .

<span class="c"># This boolean controls whether PAM will be used for password changes
# when requested by an SMB client instead of the program listed in
# 'passwd program'. The default is 'no'.
</span>   <span class="n">pam</span> <span class="n">password</span> <span class="n">change</span> = <span class="n">yes</span>

<span class="c"># This option controls how unsuccessful authentication attempts are mapped
# to anonymous connections
</span>   <span class="n">map</span> <span class="n">to</span> <span class="n">guest</span> = <span class="n">bad</span> <span class="n">user</span>

<span class="c">########## Domains ###########
</span>
<span class="c">#
# The following settings only takes effect if 'server role = classic
# primary domain controller', 'server role = classic backup domain controller'
# or 'domain logons' is set 
#
</span>
<span class="c"># It specifies the location of the user's
# profile directory from the client point of view) The following
# required a [profiles] share to be setup on the samba server (see
# below)
</span>;   <span class="n">logon</span> <span class="n">path</span> = \\%<span class="n">N</span>\<span class="n">profiles</span>\%<span class="n">U</span>
<span class="c"># Another common choice is storing the profile in the user's home directory
# (this is Samba's default)
#   logon path = \\%N\%U\profile
</span>
<span class="c"># The following setting only takes effect if 'domain logons' is set
# It specifies the location of a user's home directory (from the client
# point of view)
</span>;   <span class="n">logon</span> <span class="n">drive</span> = <span class="n">H</span>:
<span class="c">#   logon home = \\%N\%U
</span>
<span class="c"># The following setting only takes effect if 'domain logons' is set
# It specifies the script to run during logon. The script must be stored
# in the [netlogon] share
# NOTE: Must be store in 'DOS' file format convention
</span>;   <span class="n">logon</span> <span class="n">script</span> = <span class="n">logon</span>.<span class="n">cmd</span>

<span class="c"># This allows Unix users to be created on the domain controller via the SAMR
# RPC pipe.  The example command creates a user account with a disabled Unix
# password; please adapt to your needs
</span>; <span class="n">add</span> <span class="n">user</span> <span class="n">script</span> = /<span class="n">usr</span>/<span class="n">sbin</span>/<span class="n">adduser</span> --<span class="n">quiet</span> --<span class="n">disabled</span>-<span class="n">password</span> --<span class="n">gecos</span> <span class="s2">""</span> %<span class="n">u</span>

<span class="c"># This allows machine accounts to be created on the domain controller via the 
# SAMR RPC pipe.  
# The following assumes a "machines" group exists on the system
</span>; <span class="n">add</span> <span class="n">machine</span> <span class="n">script</span>  = /<span class="n">usr</span>/<span class="n">sbin</span>/<span class="n">useradd</span> -<span class="n">g</span> <span class="n">machines</span> -<span class="n">c</span> <span class="s2">"%u machine account"</span> -<span class="n">d</span> /<span class="n">var</span>/<span class="n">lib</span>/<span class="n">samba</span> -<span class="n">s</span> /<span class="n">bin</span>/<span class="n">false</span> %<span class="n">u</span>

<span class="c"># This allows Unix groups to be created on the domain controller via the SAMR
# RPC pipe.  
</span>; <span class="n">add</span> <span class="n">group</span> <span class="n">script</span> = /<span class="n">usr</span>/<span class="n">sbin</span>/<span class="n">addgroup</span> --<span class="n">force</span>-<span class="n">badname</span> %<span class="n">g</span>

<span class="c">############ Misc ############
</span>
<span class="c"># Using the following line enables you to customise your configuration
# on a per machine basis. The %m gets replaced with the netbios name
# of the machine that is connecting
</span>;   <span class="n">include</span> = /<span class="n">home</span>/<span class="n">samba</span>/<span class="n">etc</span>/<span class="n">smb</span>.<span class="n">conf</span>.%<span class="n">m</span>

<span class="c"># Some defaults for winbind (make sure you're not using the ranges
# for something else.)
</span>;   <span class="n">idmap</span> <span class="n">config</span> * :              <span class="n">backend</span> = <span class="n">tdb</span>
;   <span class="n">idmap</span> <span class="n">config</span> * :              <span class="n">range</span>   = <span class="m">3000</span>-<span class="m">7999</span>
;   <span class="n">idmap</span> <span class="n">config</span> <span class="n">YOURDOMAINHERE</span> : <span class="n">backend</span> = <span class="n">tdb</span>
;   <span class="n">idmap</span> <span class="n">config</span> <span class="n">YOURDOMAINHERE</span> : <span class="n">range</span>   = <span class="m">100000</span>-<span class="m">999999</span>
;   <span class="n">template</span> <span class="n">shell</span> = /<span class="n">bin</span>/<span class="n">bash</span>

<span class="c"># Setup usershare options to enable non-root users to share folders
# with the net usershare command.
</span>
<span class="c"># Maximum number of usershare. 0 means that usershare is disabled.
#   usershare max shares = 100
</span>
<span class="c"># Allow users who've been granted usershare privileges to create
# public shares, not just authenticated ones
</span>   <span class="n">usershare</span> <span class="n">allow</span> <span class="n">guests</span> = <span class="n">yes</span>

<span class="c">#======================= Share Definitions =======================
</span>
[<span class="n">homes</span>]
   <span class="n">comment</span> = <span class="n">Home</span> <span class="n">Directories</span>
   <span class="n">browseable</span> = <span class="n">no</span>

<span class="c"># By default, the home directories are exported read-only. Change the
# next parameter to 'no' if you want to be able to write to them.
</span>   <span class="n">read</span> <span class="n">only</span> = <span class="n">yes</span>

<span class="c"># File creation mask is set to 0700 for security reasons. If you want to
# create files with group=rw permissions, set next parameter to 0775.
</span>   <span class="n">create</span> <span class="n">mask</span> = <span class="m">0700</span>

<span class="c"># Directory creation mask is set to 0700 for security reasons. If you want to
# create dirs. with group=rw permissions, set next parameter to 0775.
</span>   <span class="n">directory</span> <span class="n">mask</span> = <span class="m">0700</span>

<span class="c"># By default, \\server\username shares can be connected to by anyone
# with access to the samba server.
# The following parameter makes sure that only "username" can connect
# to \\server\username
# This might need tweaking when using external authentication schemes
</span>   <span class="n">valid</span> <span class="n">users</span> = %<span class="n">S</span>

<span class="c"># Un-comment the following and create the netlogon directory for Domain Logons
# (you need to configure Samba to act as a domain controller too.)
</span>;[<span class="n">netlogon</span>]
;   <span class="n">comment</span> = <span class="n">Network</span> <span class="n">Logon</span> <span class="n">Service</span>
;   <span class="n">path</span> = /<span class="n">home</span>/<span class="n">samba</span>/<span class="n">netlogon</span>
;   <span class="n">guest</span> <span class="n">ok</span> = <span class="n">yes</span>
;   <span class="n">read</span> <span class="n">only</span> = <span class="n">yes</span>

<span class="c"># Un-comment the following and create the profiles directory to store
# users profiles (see the "logon path" option above)
# (you need to configure Samba to act as a domain controller too.)
# The path below should be writable by all users so that their
# profile directory may be created the first time they log on
</span>;[<span class="n">profiles</span>]
;   <span class="n">comment</span> = <span class="n">Users</span> <span class="n">profiles</span>
;   <span class="n">path</span> = /<span class="n">home</span>/<span class="n">samba</span>/<span class="n">profiles</span>
;   <span class="n">guest</span> <span class="n">ok</span> = <span class="n">no</span>
;   <span class="n">browseable</span> = <span class="n">no</span>
;   <span class="n">create</span> <span class="n">mask</span> = <span class="m">0600</span>
;   <span class="n">directory</span> <span class="n">mask</span> = <span class="m">0700</span>

[<span class="n">printers</span>]
   <span class="n">comment</span> = <span class="n">All</span> <span class="n">Printers</span>
   <span class="n">browseable</span> = <span class="n">no</span>
   <span class="n">path</span> = /<span class="n">var</span>/<span class="n">spool</span>/<span class="n">samba</span>
   <span class="n">printable</span> = <span class="n">yes</span>
   <span class="n">guest</span> <span class="n">ok</span> = <span class="n">no</span>
   <span class="n">read</span> <span class="n">only</span> = <span class="n">yes</span>
   <span class="n">create</span> <span class="n">mask</span> = <span class="m">0700</span>

<span class="c"># Windows clients look for this share name as a source of downloadable
# printer drivers
</span>[<span class="n">print</span>$]
   <span class="n">comment</span> = <span class="n">Printer</span> <span class="n">Drivers</span>
   <span class="n">path</span> = /<span class="n">var</span>/<span class="n">lib</span>/<span class="n">samba</span>/<span class="n">printers</span>
   <span class="n">browseable</span> = <span class="n">yes</span>
   <span class="n">read</span> <span class="n">only</span> = <span class="n">yes</span>
   <span class="n">guest</span> <span class="n">ok</span> = <span class="n">no</span>
<span class="c"># Uncomment to allow remote administration of Windows print drivers.
# You may need to replace 'lpadmin' with the name of the group your
# admin users are members of.
# Please note that you also need to set appropriate Unix permissions
# to the drivers directory for these users to have write rights in it
</span>;   <span class="n">write</span> <span class="n">list</span> = <span class="n">root</span>, @<span class="n">lpadmin</span>

[<span class="n">public</span>]
<span class="c"># boolean值参数注释写在后面会报错
</span>   <span class="c"># 说明文本
</span>   <span class="n">comment</span> = <span class="n">umasbox</span>       
   <span class="c"># 共享路径
</span>   <span class="n">path</span> = /<span class="n">root</span>/<span class="n">share</span>/     
   <span class="c"># 有效用户
</span>   <span class="n">valid</span> <span class="n">users</span> = <span class="n">root</span>      
   <span class="c"># 只读
</span>   <span class="n">read</span> <span class="n">only</span> = <span class="n">no</span>
   <span class="c"># 创建文件的权限
</span>   <span class="n">create</span> <span class="n">mask</span> = <span class="m">0777</span>      
   <span class="c"># 创建文件夹的权限
</span>   <span class="n">directory</span> <span class="n">mask</span> = <span class="m">0777</span>   
   <span class="c"># 允许访客 
</span>   <span class="n">guest</span> <span class="n">ok</span> = <span class="n">no</span>  
   <span class="c"># 可见            
</span>   <span class="n">browseable</span> = <span class="n">yes</span>        
   
</code></pre></div></div>

<ul>
  <li>smb_ubuntu.conf</li>
</ul>

<div class="language-conf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#
# Sample configuration file for the Samba suite for Debian GNU/Linux.
#
#
# This is the main Samba configuration file. You should read the
# smb.conf(5) manual page in order to understand the options listed
# here. Samba has a huge number of configurable options most of which 
# are not shown in this example
#
# Some options that are often worth tuning have been included as
# commented-out examples in this file.
#  - When such options are commented with ";", the proposed setting
#    differs from the default Samba behaviour
#  - When commented with "#", the proposed setting is the default
#    behaviour of Samba but the option is considered important
#    enough to be mentioned here
#
# NOTE: Whenever you modify this file you should run the command
# "testparm" to check that you have not made any basic syntactic 
# errors. 
</span>
<span class="c">#======================= Global Settings =======================
</span>
[<span class="n">global</span>]

<span class="c">## Browsing/Identification ###
</span>
<span class="c"># Change this to the workgroup/NT-domain name your Samba server will part of
</span>   <span class="n">workgroup</span> = <span class="n">WORKGROUP</span>

<span class="c"># server string is the equivalent of the NT Description field
</span>   <span class="n">server</span> <span class="n">string</span> = %<span class="n">h</span> <span class="n">server</span> (<span class="n">Samba</span>, <span class="n">Ubuntu</span>)

<span class="c">#### Networking ####
</span>
<span class="c"># The specific set of interfaces / networks to bind to
# This can be either the interface name or an IP address/netmask;
# interface names are normally preferred
</span>;   <span class="n">interfaces</span> = <span class="m">127</span>.<span class="m">0</span>.<span class="m">0</span>.<span class="m">0</span>/<span class="m">8</span> <span class="n">eth0</span>

<span class="c"># Only bind to the named interfaces and/or networks; you must use the
# 'interfaces' option above to use this.
# It is recommended that you enable this feature if your Samba machine is
# not protected by a firewall or is a firewall itself.  However, this
# option cannot handle dynamic or non-broadcast interfaces correctly.
</span>;   <span class="n">bind</span> <span class="n">interfaces</span> <span class="n">only</span> = <span class="n">yes</span>



<span class="c">#### Debugging/Accounting ####
</span>
<span class="c"># This tells Samba to use a separate log file for each machine
# that connects
</span>   <span class="n">log</span> <span class="n">file</span> = /<span class="n">var</span>/<span class="n">log</span>/<span class="n">samba</span>/<span class="n">log</span>.%<span class="n">m</span>

<span class="c"># Cap the size of the individual log files (in KiB).
</span>   <span class="n">max</span> <span class="n">log</span> <span class="n">size</span> = <span class="m">1000</span>

<span class="c"># We want Samba to only log to /var/log/samba/log.{smbd,nmbd}.
# Append syslog@1 if you want important messages to be sent to syslog too.
</span>   <span class="n">logging</span> = <span class="n">file</span>

<span class="c"># Do something sensible when Samba crashes: mail the admin a backtrace
</span>   <span class="n">panic</span> <span class="n">action</span> = /<span class="n">usr</span>/<span class="n">share</span>/<span class="n">samba</span>/<span class="n">panic</span>-<span class="n">action</span> %<span class="n">d</span>


<span class="c">####### Authentication #######
</span>
<span class="c"># Server role. Defines in which mode Samba will operate. Possible
# values are "standalone server", "member server", "classic primary
# domain controller", "classic backup domain controller", "active
# directory domain controller". 
#
# Most people will want "standalone server" or "member server".
# Running as "active directory domain controller" will require first
# running "samba-tool domain provision" to wipe databases and create a
# new domain.
</span>   <span class="n">server</span> <span class="n">role</span> = <span class="n">standalone</span> <span class="n">server</span>

   <span class="n">obey</span> <span class="n">pam</span> <span class="n">restrictions</span> = <span class="n">yes</span>

<span class="c"># This boolean parameter controls whether Samba attempts to sync the Unix
# password with the SMB password when the encrypted SMB password in the
# passdb is changed.
</span>   <span class="n">unix</span> <span class="n">password</span> <span class="n">sync</span> = <span class="n">yes</span>

<span class="c"># For Unix password sync to work on a Debian GNU/Linux system, the following
# parameters must be set (thanks to Ian Kahan &lt;&lt;kahan@informatik.tu-muenchen.de&gt; for
# sending the correct chat script for the passwd program in Debian Sarge).
</span>   <span class="n">passwd</span> <span class="n">program</span> = /<span class="n">usr</span>/<span class="n">bin</span>/<span class="n">passwd</span> %<span class="n">u</span>
   <span class="n">passwd</span> <span class="n">chat</span> = *<span class="n">Enter</span>\<span class="n">snew</span>\<span class="n">s</span>*\<span class="n">spassword</span>:* %<span class="n">n</span>\<span class="n">n</span> *<span class="n">Retype</span>\<span class="n">snew</span>\<span class="n">s</span>*\<span class="n">spassword</span>:* %<span class="n">n</span>\<span class="n">n</span> *<span class="n">password</span>\<span class="n">supdated</span>\<span class="n">ssuccessfully</span>* .

<span class="c"># This boolean controls whether PAM will be used for password changes
# when requested by an SMB client instead of the program listed in
# 'passwd program'. The default is 'no'.
</span>   <span class="n">pam</span> <span class="n">password</span> <span class="n">change</span> = <span class="n">yes</span>

<span class="c"># This option controls how unsuccessful authentication attempts are mapped
# to anonymous connections
</span>   <span class="n">map</span> <span class="n">to</span> <span class="n">guest</span> = <span class="n">bad</span> <span class="n">user</span>

<span class="c">########## Domains ###########
</span>
<span class="c">#
# The following settings only takes effect if 'server role = primary
# classic domain controller', 'server role = backup domain controller'
# or 'domain logons' is set 
#
</span>
<span class="c"># It specifies the location of the user's
# profile directory from the client point of view) The following
# required a [profiles] share to be setup on the samba server (see
# below)
</span>;   <span class="n">logon</span> <span class="n">path</span> = \\%<span class="n">N</span>\<span class="n">profiles</span>\%<span class="n">U</span>
<span class="c"># Another common choice is storing the profile in the user's home directory
# (this is Samba's default)
#   logon path = \\%N\%U\profile
</span>
<span class="c"># The following setting only takes effect if 'domain logons' is set
# It specifies the location of a user's home directory (from the client
# point of view)
</span>;   <span class="n">logon</span> <span class="n">drive</span> = <span class="n">H</span>:
<span class="c">#   logon home = \\%N\%U
</span>
<span class="c"># The following setting only takes effect if 'domain logons' is set
# It specifies the script to run during logon. The script must be stored
# in the [netlogon] share
# NOTE: Must be store in 'DOS' file format convention
</span>;   <span class="n">logon</span> <span class="n">script</span> = <span class="n">logon</span>.<span class="n">cmd</span>

<span class="c"># This allows Unix users to be created on the domain controller via the SAMR
# RPC pipe.  The example command creates a user account with a disabled Unix
# password; please adapt to your needs
</span>; <span class="n">add</span> <span class="n">user</span> <span class="n">script</span> = /<span class="n">usr</span>/<span class="n">sbin</span>/<span class="n">adduser</span> --<span class="n">quiet</span> --<span class="n">disabled</span>-<span class="n">password</span> --<span class="n">gecos</span> <span class="s2">""</span> %<span class="n">u</span>

<span class="c"># This allows machine accounts to be created on the domain controller via the 
# SAMR RPC pipe.  
# The following assumes a "machines" group exists on the system
</span>; <span class="n">add</span> <span class="n">machine</span> <span class="n">script</span>  = /<span class="n">usr</span>/<span class="n">sbin</span>/<span class="n">useradd</span> -<span class="n">g</span> <span class="n">machines</span> -<span class="n">c</span> <span class="s2">"%u machine account"</span> -<span class="n">d</span> /<span class="n">var</span>/<span class="n">lib</span>/<span class="n">samba</span> -<span class="n">s</span> /<span class="n">bin</span>/<span class="n">false</span> %<span class="n">u</span>

<span class="c"># This allows Unix groups to be created on the domain controller via the SAMR
# RPC pipe.  
</span>; <span class="n">add</span> <span class="n">group</span> <span class="n">script</span> = /<span class="n">usr</span>/<span class="n">sbin</span>/<span class="n">addgroup</span> --<span class="n">force</span>-<span class="n">badname</span> %<span class="n">g</span>

<span class="c">############ Misc ############
</span>
<span class="c"># Using the following line enables you to customise your configuration
# on a per machine basis. The %m gets replaced with the netbios name
# of the machine that is connecting
</span>;   <span class="n">include</span> = /<span class="n">home</span>/<span class="n">samba</span>/<span class="n">etc</span>/<span class="n">smb</span>.<span class="n">conf</span>.%<span class="n">m</span>

<span class="c"># Some defaults for winbind (make sure you're not using the ranges
# for something else.)
</span>;   <span class="n">idmap</span> <span class="n">config</span> * :              <span class="n">backend</span> = <span class="n">tdb</span>
;   <span class="n">idmap</span> <span class="n">config</span> * :              <span class="n">range</span>   = <span class="m">3000</span>-<span class="m">7999</span>
;   <span class="n">idmap</span> <span class="n">config</span> <span class="n">YOURDOMAINHERE</span> : <span class="n">backend</span> = <span class="n">tdb</span>
;   <span class="n">idmap</span> <span class="n">config</span> <span class="n">YOURDOMAINHERE</span> : <span class="n">range</span>   = <span class="m">100000</span>-<span class="m">999999</span>
;   <span class="n">template</span> <span class="n">shell</span> = /<span class="n">bin</span>/<span class="n">bash</span>

<span class="c"># Setup usershare options to enable non-root users to share folders
# with the net usershare command.
</span>
<span class="c"># Maximum number of usershare. 0 means that usershare is disabled.
#   usershare max shares = 100
</span>
<span class="c"># Allow users who've been granted usershare privileges to create
# public shares, not just authenticated ones
</span>   <span class="n">usershare</span> <span class="n">allow</span> <span class="n">guests</span> = <span class="n">yes</span>

<span class="c">#======================= Share Definitions =======================
</span>
<span class="c"># Un-comment the following (and tweak the other settings below to suit)
# to enable the default home directory shares. This will share each
# user's home directory as \\server\username
</span>;[<span class="n">homes</span>]
;   <span class="n">comment</span> = <span class="n">Home</span> <span class="n">Directories</span>
;   <span class="n">browseable</span> = <span class="n">no</span>

<span class="c"># By default, the home directories are exported read-only. Change the
# next parameter to 'no' if you want to be able to write to them.
</span>;   <span class="n">read</span> <span class="n">only</span> = <span class="n">yes</span>

<span class="c"># File creation mask is set to 0700 for security reasons. If you want to
# create files with group=rw permissions, set next parameter to 0775.
</span>;   <span class="n">create</span> <span class="n">mask</span> = <span class="m">0700</span>

<span class="c"># Directory creation mask is set to 0700 for security reasons. If you want to
# create dirs. with group=rw permissions, set next parameter to 0775.
</span>;   <span class="n">directory</span> <span class="n">mask</span> = <span class="m">0700</span>

<span class="c"># By default, \\server\username shares can be connected to by anyone
# with access to the samba server.
# Un-comment the following parameter to make sure that only "username"
# can connect to \\server\username
# This might need tweaking when using external authentication schemes
</span>;   <span class="n">valid</span> <span class="n">users</span> = %<span class="n">S</span>

<span class="c"># Un-comment the following and create the netlogon directory for Domain Logons
# (you need to configure Samba to act as a domain controller too.)
</span>;[<span class="n">netlogon</span>]
;   <span class="n">comment</span> = <span class="n">Network</span> <span class="n">Logon</span> <span class="n">Service</span>
;   <span class="n">path</span> = /<span class="n">home</span>/<span class="n">samba</span>/<span class="n">netlogon</span>
;   <span class="n">guest</span> <span class="n">ok</span> = <span class="n">yes</span>
;   <span class="n">read</span> <span class="n">only</span> = <span class="n">yes</span>

<span class="c"># Un-comment the following and create the profiles directory to store
# users profiles (see the "logon path" option above)
# (you need to configure Samba to act as a domain controller too.)
# The path below should be writable by all users so that their
# profile directory may be created the first time they log on
</span>;[<span class="n">profiles</span>]
;   <span class="n">comment</span> = <span class="n">Users</span> <span class="n">profiles</span>
;   <span class="n">path</span> = /<span class="n">home</span>/<span class="n">samba</span>/<span class="n">profiles</span>
;   <span class="n">guest</span> <span class="n">ok</span> = <span class="n">no</span>
;   <span class="n">browseable</span> = <span class="n">no</span>
;   <span class="n">create</span> <span class="n">mask</span> = <span class="m">0600</span>
;   <span class="n">directory</span> <span class="n">mask</span> = <span class="m">0700</span>

[<span class="n">printers</span>]
   <span class="n">comment</span> = <span class="n">All</span> <span class="n">Printers</span>
   <span class="n">browseable</span> = <span class="n">no</span>
   <span class="n">path</span> = /<span class="n">var</span>/<span class="n">spool</span>/<span class="n">samba</span>
   <span class="n">printable</span> = <span class="n">yes</span>
   <span class="n">guest</span> <span class="n">ok</span> = <span class="n">no</span>
   <span class="n">read</span> <span class="n">only</span> = <span class="n">yes</span>
   <span class="n">create</span> <span class="n">mask</span> = <span class="m">0700</span>

<span class="c"># Windows clients look for this share name as a source of downloadable
# printer drivers
</span>[<span class="n">print</span>$]
   <span class="n">comment</span> = <span class="n">Printer</span> <span class="n">Drivers</span>
   <span class="n">path</span> = /<span class="n">var</span>/<span class="n">lib</span>/<span class="n">samba</span>/<span class="n">printers</span>
   <span class="n">browseable</span> = <span class="n">yes</span>
   <span class="n">read</span> <span class="n">only</span> = <span class="n">yes</span>
   <span class="n">guest</span> <span class="n">ok</span> = <span class="n">no</span>
<span class="c"># Uncomment to allow remote administration of Windows print drivers.
# You may need to replace 'lpadmin' with the name of the group your
# admin users are members of.
# Please note that you also need to set appropriate Unix permissions
# to the drivers directory for these users to have write rights in it
</span>;   <span class="n">write</span> <span class="n">list</span> = <span class="n">root</span>, @<span class="n">lpadmin</span>

[<span class="n">public</span>]
   <span class="c"># 说明文本
</span>   <span class="n">comment</span> = <span class="n">umasbox</span>       
   <span class="c"># 共享路径
</span>   <span class="n">path</span> = /<span class="n">root</span>/<span class="n">share</span>/     
   <span class="c"># 有效用户
</span>   <span class="n">valid</span> <span class="n">users</span> = <span class="n">root</span>      
   <span class="c"># 只读
</span>   <span class="n">read</span> <span class="n">only</span> = <span class="n">no</span>
   <span class="c"># 创建文件的权限
</span>   <span class="n">create</span> <span class="n">mask</span> = <span class="m">0777</span>      
   <span class="c"># 创建文件夹的权限
</span>   <span class="n">directory</span> <span class="n">mask</span> = <span class="m">0777</span>   
   <span class="c"># 允许访客 
</span>   <span class="n">guest</span> <span class="n">ok</span> = <span class="n">no</span>  
   <span class="c"># 可见            
</span>   <span class="n">browseable</span> = <span class="n">yes</span>  

</code></pre></div></div>]]></content><author><name></name></author><category term="bash" /><summary type="html"><![CDATA[简单介绍项目需求 略]]></summary></entry><entry><title type="html">bash: init_ssh 一键部署linux主机的ssh环境</title><link href="/bash/init_ssh/" rel="alternate" type="text/html" title="bash: init_ssh 一键部署linux主机的ssh环境" /><published>2023-06-29T14:35:00+08:00</published><updated>2023-06-29T14:35:00+08:00</updated><id>/bash/init_ssh</id><content type="html" xml:base="/bash/init_ssh/"><![CDATA[<ul>
  <li>简单介绍项目需求
    <ul>
      <li>略</li>
    </ul>
  </li>
  <li>sh脚本</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#! /bin/bash</span>


<span class="c"># ### - init_ssh [ssh登录和gitee公钥设置]</span>
<span class="c"># - 脚本调用  </span>
<span class="c"># ```./setup.sh```</span>
<span class="c"># - 参数修改</span>
<span class="c">#     - 启动命令及端口</span>


<span class="c"># 参数：端口</span>
<span class="nv">port</span><span class="o">=</span>64822


<span class="c"># 参数：启动命令</span>
<span class="nv">ssh_cmd</span><span class="o">=</span><span class="s2">"service ssh start"</span>      <span class="c"># common ssh, 大多数环境适用</span>
<span class="c"># ssh_cmd="/sbin/sshd -p $port"    # termux ssh, 目前已知wsl环境不可用</span>


<span class="c"># 确认启动命令</span>
<span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">ssh command select: </span><span class="nv">$ssh_cmd</span><span class="se">\n</span><span class="s2">port: </span><span class="nv">$port</span><span class="se">\n</span><span class="s2">press enter to continue..."</span>
<span class="nb">read</span> <span class="nt">-r</span> input


<span class="c"># 切换工作目录</span>
<span class="nb">cd</span> <span class="sb">`</span><span class="nb">dirname</span> <span class="nv">$0</span><span class="sb">`</span>

apt update 
apt <span class="nb">install </span>ssh

<span class="c"># 创建.user_profile文件并写入.bashrc启动项</span>
<span class="k">if</span> <span class="o">[</span> <span class="o">!</span> <span class="nt">-e</span> ~/.user_profile <span class="o">]</span><span class="p">;</span><span class="k">then
    </span><span class="nb">touch</span> ~/.user_profile
<span class="k">else
    </span><span class="nb">echo</span> <span class="s2">"user_profile already exist"</span>
<span class="k">fi
if</span> <span class="o">!(</span> <span class="nb">cat</span> /root/.bashrc | <span class="nb">grep</span> <span class="s2">"user_profile"</span> <span class="o">&gt;</span> /dev/null <span class="o">)</span><span class="p">;</span><span class="k">then
    </span><span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">echo 'setup command : ~/.user_profile'</span><span class="se">\n</span><span class="s2">"</span> <span class="o">&gt;&gt;</span> /root/.bashrc
    <span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"if [ -f ~/.user_profile ]; then</span><span class="se">\n\t</span><span class="s2">. ~/.user_profile</span><span class="se">\n</span><span class="s2">fi"</span> <span class="o">&gt;&gt;</span> /root/.bashrc
<span class="k">else
    </span><span class="nb">echo</span> <span class="s2">"user_profile already loaded in bashrc"</span>
<span class="k">fi</span>

<span class="c"># ssh 连接配置</span>
<span class="c"># /etc/ssh/sshd_config允许root登录</span>
<span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"</span><span class="se">\n</span><span class="s2"> ========== ssh config ========== </span><span class="se">\n</span><span class="s2">"</span>
<span class="nb">echo</span> <span class="s2">"root:umas1970"</span> | chpasswd 
<span class="k">if </span><span class="nb">cat</span> <span class="s1">'/etc/ssh/sshd_config'</span> | <span class="nb">grep</span> <span class="s2">"^PermitRootLogin"</span> <span class="o">&gt;</span> /dev/null <span class="p">;</span><span class="k">then
    </span><span class="nb">sed</span> <span class="nt">-i</span> <span class="s2">"/^PermitRootLogin*/cPermitRootLogin yes"</span> /etc/ssh/sshd_config
<span class="k">else
    </span><span class="nb">echo</span> <span class="s2">"PermitRootLogin yes"</span> <span class="o">&gt;&gt;</span> /etc/ssh/sshd_config
<span class="k">fi
if </span><span class="nb">cat</span> <span class="s1">'/etc/ssh/sshd_config'</span> | <span class="nb">grep</span> <span class="s2">"^PasswordAuthentication"</span> <span class="o">&gt;</span> /dev/null <span class="p">;</span><span class="k">then
    </span><span class="nb">sed</span> <span class="nt">-i</span> <span class="s2">"/^PasswordAuthentication*/cPasswordAuthentication yes"</span> /etc/ssh/sshd_config
<span class="k">else
    </span><span class="nb">echo</span> <span class="s2">"PasswordAuthentication yes"</span> <span class="o">&gt;&gt;</span> /etc/ssh/sshd_config
<span class="k">fi</span>
<span class="c"># 修改默认端口64822</span>
<span class="k">if </span><span class="nb">cat</span> <span class="s1">'/etc/ssh/sshd_config'</span> | <span class="nb">grep</span> <span class="s2">"^Port"</span> <span class="o">&gt;</span> /dev/null <span class="p">;</span><span class="k">then
    </span><span class="nb">sed</span> <span class="nt">-i</span> <span class="s2">"/^Port*/Port </span><span class="nv">$port</span><span class="s2">"</span> /etc/ssh/sshd_config
<span class="k">else
    </span><span class="nb">echo</span> <span class="s2">"Port </span><span class="nv">$port</span><span class="s2">"</span> <span class="o">&gt;&gt;</span> /etc/ssh/sshd_config
<span class="k">fi</span>


<span class="c"># 加入.user_profile启动项</span>
<span class="k">if</span> <span class="o">!(</span> <span class="nb">cat</span> /root/.user_profile | <span class="nb">grep</span> <span class="s2">"user profile: ssh"</span> <span class="o">&gt;</span> /dev/null <span class="o">)</span><span class="p">;</span><span class="k">then
    </span><span class="nb">echo</span> <span class="s2">"# user profile: ssh"</span> <span class="o">&gt;&gt;</span> /root/.user_profile
    <span class="nb">echo</span> <span class="s2">"echo ' * ssh: </span><span class="nv">$ssh_cmd</span><span class="s2"> starting ...'"</span> <span class="o">&gt;&gt;</span> /root/.user_profile
    <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$ssh_cmd</span><span class="s2">"</span> <span class="o">&gt;&gt;</span> /root/.user_profile
    <span class="nb">echo</span> <span class="s2">"ip addr show | grep 192"</span> <span class="o">&gt;&gt;</span> /root/.user_profile
<span class="k">fi</span>

<span class="c"># 要求windows公钥</span>
<span class="nb">yes</span> | ssh-keygen <span class="nt">-t</span> rsa <span class="nt">-P</span> <span class="s2">""</span> <span class="nt">-f</span> ~/.ssh/id_rsa
<span class="nb">echo</span> <span class="nt">-en</span> <span class="s2">"create ssh public key in windows :</span><span class="se">\n\n\t</span><span class="s2">ssh-keygen -t rsa -b 4096</span><span class="se">\n\n</span><span class="s2"> </span><span class="se">\</span><span class="s2">
then copy C:</span><span class="se">\U</span><span class="s2">sers</span><span class="se">\u</span><span class="s2">mas2017</span><span class="se">\.</span><span class="s2">ssh</span><span class="se">\i</span><span class="s2">d_rsa.pub here:</span><span class="se">\n</span><span class="s2">id_rsa.pub (press enter to skip): "</span>
<span class="nb">read</span> <span class="nt">-r</span> input
<span class="k">if</span> <span class="o">[[</span> <span class="nv">$input</span> <span class="o">!=</span> <span class="s2">""</span> <span class="o">]]</span><span class="p">;</span><span class="k">then
    if</span> <span class="o">[</span> <span class="nt">-f</span> ~/.ssh/authorized_keys <span class="o">]</span><span class="p">;</span><span class="k">then
        if </span><span class="nb">cat</span> ~/.ssh/authorized_keys | <span class="nb">grep</span> <span class="s2">"</span><span class="nv">$input</span><span class="s2">"</span> <span class="o">&gt;</span> /dev/null <span class="p">;</span><span class="k">then
            </span><span class="nb">echo</span> <span class="nv">$input</span> <span class="o">&gt;&gt;</span> ~/.ssh/authorized_keys
        <span class="k">else
            </span><span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">公钥已存在</span><span class="se">\n</span><span class="s2">"</span>
        <span class="k">fi
    else 
        </span><span class="nb">echo</span> <span class="nv">$input</span> <span class="o">&gt;&gt;</span> ~/.ssh/authorized_keys 
    <span class="k">fi
fi</span>

<span class="c"># load一次bashrc作为启动</span>
<span class="nb">source</span> ~/.bashrc



<span class="c"># gitee 公钥设置</span>
<span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"</span><span class="se">\n</span><span class="s2"> ========== gitee config ========== </span><span class="se">\n</span><span class="s2">"</span>
git config <span class="nt">--global</span> user.email <span class="s2">"1970313791@qq.com"</span>
git config <span class="nt">--global</span> user.name <span class="s2">"umas"</span>
<span class="nb">printf</span> <span class="s2">"</span><span class="se">\n\n\n</span><span class="s2">"</span> | ssh-keygen <span class="nt">-t</span> ed25519 <span class="nt">-C</span> <span class="s2">"1970313791@qq.com"</span> 
<span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"</span><span class="se">\n\n</span><span class="s2">"</span>
<span class="nb">cat</span> ~/.ssh/id_ed25519.pub
<span class="nb">echo</span> <span class="nt">-en</span> <span class="s2">"</span><span class="se">\n\n</span><span class="s2">ssh public key above, fill in gitee:</span><span class="se">\n\n\t</span><span class="s2"> </span><span class="se">\</span><span class="s2">
https://gitee.com/profile/sshkeys</span><span class="se">\n\n</span><span class="s2">press enter to continue"</span>
<span class="nb">read</span> <span class="nt">-r</span> input
ssh <span class="nt">-T</span> git@gitee.com

<span class="nb">echo</span> <span class="nt">-en</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">process finish, The following command can change http-git to ssh-git</span><span class="se">\n\n\</span><span class="s2">
</span><span class="se">\t</span><span class="s2">git remote rm origin</span><span class="se">\n\</span><span class="s2">
</span><span class="se">\t</span><span class="s2">git remote add origin git@gitee.com:umas/umasbox.git</span><span class="se">\n\</span><span class="s2">
</span><span class="se">\t</span><span class="s2">git push --set-upstream origin master</span><span class="se">\n\n</span><span class="s2">"</span>

<span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">ssh setup finish</span><span class="se">\n</span><span class="s2">"</span>


</code></pre></div></div>]]></content><author><name></name></author><category term="bash" /><summary type="html"><![CDATA[简单介绍项目需求 略]]></summary></entry><entry><title type="html">bash: init_node 一键部署nodejs+vue开发环境在ubuntu主机上</title><link href="/bash/init_node/" rel="alternate" type="text/html" title="bash: init_node 一键部署nodejs+vue开发环境在ubuntu主机上" /><published>2023-06-29T14:25:00+08:00</published><updated>2023-06-29T14:25:00+08:00</updated><id>/bash/init_node</id><content type="html" xml:base="/bash/init_node/"><![CDATA[<ul>
  <li>简单介绍项目需求
    <ul>
      <li>略</li>
    </ul>
  </li>
  <li>sh脚本</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#! /bin/bash</span>

<span class="c"># ### - init_node [node.js+vue前端开发环境配置]</span>
<span class="c"># - 脚本调用  </span>
<span class="c"># ```./setup.sh```</span>
<span class="c"># - 参数修改</span>
<span class="c">#     - 前端目录：/init_node/setup.sh - project_path (line4)</span>


<span class="c"># 参数：前端项目路径</span>
<span class="nv">project_path</span><span class="o">=</span><span class="s2">"/root/onebox/server_frontend"</span>
<span class="c">#project_path="/root/onebox/intf_electron_vue/intf_electron"</span>

<span class="c"># 切换工作目录</span>
<span class="nb">cd</span> <span class="sb">`</span><span class="nb">dirname</span> <span class="nv">$0</span><span class="sb">`</span>

<span class="c"># 确认路径</span>
<span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">frontend project path: </span><span class="nv">$project_path</span><span class="se">\n</span><span class="s2">press enter to continue ..."</span>
<span class="nb">read</span> <span class="nt">-r</span> input

<span class="c"># nvm需要安装git</span>
apt update
apt <span class="nb">install </span>git

<span class="c"># 安装nvm并用国内源安装nodejs，使用gitee，该三方源稳定性不能保证</span>
<span class="nb">cd</span> ~
<span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">========== node: install node ==========</span><span class="se">\n</span><span class="s2">"</span>
<span class="k">if</span> <span class="o">[</span> <span class="nt">-d</span> <span class="s2">"/root/.nvm"</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="o">[[</span> <span class="sb">`</span><span class="nb">ls</span> <span class="nt">-A</span> /root/.nvm<span class="sb">`</span> <span class="o">!=</span> <span class="s2">""</span> <span class="o">]]</span><span class="p">;</span><span class="k">then
    </span><span class="nb">echo</span> <span class="s2">"nvm already exist"</span>
<span class="k">else
    </span>git clone https://gitee.com/Annlix/nvm-sh_nvm.git
    bash ./nvm-sh_nvm/install.sh
    <span class="nb">export </span><span class="nv">NVM_NODEJS_ORG_MIRROR</span><span class="o">=</span>https://npm.taobao.org/mirrors/node
    <span class="nb">source</span> ~/.bashrc
<span class="k">fi
</span><span class="nb">source</span> ~/.nvm/nvm.sh
nvm <span class="nb">install </span>16.14.0
<span class="nb">source</span> ~/.bashrc


<span class="c"># 进入项目目录安装node modules</span>
<span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">========== node: install modules ==========</span><span class="se">\n</span><span class="s2">"</span>
npm <span class="nb">install</span> <span class="nt">-g</span> nrm
nrm use taobao
<span class="nb">cd</span> <span class="nv">$project_path</span>
npm i


<span class="c"># 以防万一打包一遍</span>
<span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">========== node: run build ==========</span><span class="se">\n</span><span class="s2">"</span>
npm run build





</code></pre></div></div>]]></content><author><name></name></author><category term="bash" /><summary type="html"><![CDATA[简单介绍项目需求 略]]></summary></entry><entry><title type="html">bash: init_nginx 一键部署nginx在ubuntu主机上</title><link href="/bash/init_nginx/" rel="alternate" type="text/html" title="bash: init_nginx 一键部署nginx在ubuntu主机上" /><published>2023-06-29T14:15:00+08:00</published><updated>2023-06-29T14:15:00+08:00</updated><id>/bash/init_nginx</id><content type="html" xml:base="/bash/init_nginx/"><![CDATA[<ul>
  <li>简单介绍nginx
    <ul>
      <li>略</li>
    </ul>
  </li>
  <li>sh脚本</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#! /bin/bash</span>


<span class="c"># ### - init_nginx [nginx静态页面服务器]</span>
<span class="c"># - 脚本调用  </span>
<span class="c"># ```./setup.sh```</span>
<span class="c"># - 参数修改</span>
<span class="c">#     - index.html文件位置：init_nginx/frontend.conf - server.root (line 12)</span>
<span class="c">#     - 登录用户名：init_nginx.nginx.conf - user (line 1)</span>
<span class="c"># - 注意</span>
<span class="c">#     - 默认端口8080</span>


<span class="c"># 切换工作目录</span>
<span class="nb">cd</span> <span class="sb">`</span><span class="nb">dirname</span> <span class="nv">$0</span><span class="sb">`</span>

<span class="c"># 参数：端口</span>
<span class="nv">port</span><span class="o">=</span>4080
<span class="c"># 参数：dist文件路径</span>
<span class="c"># dist_path="/root/umasbox/frontend/dist"</span>
<span class="nv">dist_path</span><span class="o">=</span><span class="s2">"/mnt/d/s-linux/project/onebox/server_frontend/dist"</span>

<span class="c"># 确认参数</span>
<span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">nginx port: </span><span class="nv">$port</span><span class="s2">"</span>
<span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"dist path: </span><span class="nv">$dist_path</span><span class="se">\n\n</span><span class="s2">press enter to continue..."</span>
<span class="nb">read</span> <span class="nt">-r</span> input

<span class="c"># 创建.user_profile文件并写入.bashrc启动项</span>
<span class="k">if</span> <span class="o">[</span> <span class="o">!</span> <span class="nt">-e</span> ~/.user_profile <span class="o">]</span><span class="p">;</span><span class="k">then
    </span><span class="nb">touch</span> ~/.user_profile
<span class="k">else
    </span><span class="nb">echo</span> <span class="s2">"user_profile already exist"</span>
<span class="k">fi
if</span> <span class="o">!(</span> <span class="nb">cat</span> ~/.bashrc | <span class="nb">grep</span> <span class="s2">"user_profile"</span> <span class="o">&gt;</span> /dev/null <span class="o">)</span><span class="p">;</span><span class="k">then
    </span><span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">echo 'setup command : ~/.user_profile'</span><span class="se">\n</span><span class="s2">"</span> <span class="o">&gt;&gt;</span> ~/.bashrc
    <span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"if [ -f ~/.user_profile ]; then</span><span class="se">\n\t</span><span class="s2">. ~/.user_profile</span><span class="se">\n</span><span class="s2">fi"</span> <span class="o">&gt;&gt;</span> ~/.bashrc
<span class="k">else
    </span><span class="nb">echo</span> <span class="s2">"user_profile already loaded in bashrc"</span>
<span class="k">fi</span>

<span class="c"># 参数写入conf</span>
<span class="k">if </span><span class="nb">cat</span> <span class="s1">'./frontend.conf'</span> | <span class="nb">grep</span> <span class="s2">"listen"</span> <span class="o">&gt;</span> /dev/null <span class="p">;</span><span class="k">then
    </span><span class="nb">sed</span> <span class="nt">-i</span> <span class="s2">"/listen*/c</span><span class="se">\ \t</span><span class="s2">listen </span><span class="nv">$port</span><span class="s2">;"</span> ./frontend.conf
<span class="k">fi
if </span><span class="nb">cat</span> <span class="s1">'./frontend.conf'</span> | <span class="nb">grep</span> <span class="s2">"root"</span> <span class="o">&gt;</span> /dev/null <span class="p">;</span><span class="k">then
    </span><span class="nb">sed</span> <span class="nt">-i</span> <span class="s2">"/root*/c</span><span class="se">\ \t</span><span class="s2">root </span><span class="nv">$dist_path</span><span class="s2">;"</span> ./frontend.conf
<span class="k">fi

</span>apt update
apt <span class="nb">install </span>nginx <span class="nt">-y</span>

<span class="nb">cp </span>frontend.conf /etc/nginx/conf.d/frontend.conf
<span class="nb">cp </span>nginx.conf /etc/nginx/nginx.conf

<span class="k">if</span> <span class="o">!(</span> <span class="nb">cat</span> <span class="s1">'~/.user_profile'</span> | <span class="nb">grep</span> <span class="s2">"^service nginx start"</span> <span class="o">&gt;</span> /dev/null <span class="o">)</span><span class="p">;</span><span class="k">then
    </span><span class="nb">echo</span> <span class="s2">"# user profile: nginx"</span> <span class="o">&gt;&gt;</span> ~/.user_profile
    <span class="nb">echo</span> <span class="s2">"echo ' * nginx port </span><span class="nv">$port</span><span class="s2"> starting ...'"</span> <span class="o">&gt;&gt;</span> ~/.user_profile
    <span class="nb">echo</span> <span class="s2">"service nginx start"</span> <span class="o">&gt;&gt;</span> ~/.user_profile
<span class="k">fi

</span>service nginx stop
nginx <span class="nt">-c</span> /etc/nginx/nginx.conf
nginx <span class="nt">-s</span> reload

<span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">nginx setup finish</span><span class="se">\n</span><span class="s2">"</span>

</code></pre></div></div>

<ul>
  <li>考虑到版本区别，没有直接用脚本修改conf文件，而是用现有的conf文件直接覆盖</li>
  <li>nginx.conf</li>
</ul>

<div class="language-conf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">user</span>  <span class="n">root</span>;
<span class="n">worker_processes</span>  <span class="n">auto</span>;

<span class="n">error_log</span>  /<span class="n">var</span>/<span class="n">log</span>/<span class="n">nginx</span>/<span class="n">error</span>.<span class="n">log</span> <span class="n">notice</span>;
<span class="n">pid</span>        /<span class="n">var</span>/<span class="n">run</span>/<span class="n">nginx</span>.<span class="n">pid</span>;


<span class="n">events</span> {
    <span class="n">worker_connections</span>  <span class="m">1024</span>;
}


<span class="n">http</span> {
    <span class="n">include</span>       /<span class="n">etc</span>/<span class="n">nginx</span>/<span class="n">mime</span>.<span class="n">types</span>;
    <span class="n">default_type</span>  <span class="n">application</span>/<span class="n">octet</span>-<span class="n">stream</span>;

    <span class="n">log_format</span>  <span class="n">main</span>  <span class="s1">'$remote_addr - $remote_user [$time_local] "$request" '</span>
                      <span class="s1">'$status $body_bytes_sent "$http_referer" '</span>
                      <span class="s1">'"$http_user_agent" "$http_x_forwarded_for"'</span>;

    <span class="n">access_log</span>  /<span class="n">var</span>/<span class="n">log</span>/<span class="n">nginx</span>/<span class="n">access</span>.<span class="n">log</span>  <span class="n">main</span>;

    <span class="n">sendfile</span>        <span class="n">on</span>;
    <span class="c">#tcp_nopush     on;
</span>
    <span class="n">keepalive_timeout</span>  <span class="m">65</span>;

    <span class="c">#gzip  on;
</span>
    <span class="n">include</span> /<span class="n">etc</span>/<span class="n">nginx</span>/<span class="n">conf</span>.<span class="n">d</span>/*.<span class="n">conf</span>;
}
</code></pre></div></div>

<ul>
  <li>frontend.conf</li>
</ul>

<div class="language-conf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># # 负载均衡（以后再研究）
# upstream test {
#     server localhost:8080;
#     server localhost:8081;
#     ip_hash; # 同一ip请求定向到同一后端
# }
</span>
<span class="c"># 静态网页
</span><span class="n">server</span> {
    <span class="n">listen</span> <span class="m">4080</span>;
    <span class="n">server_name</span> <span class="n">box_server</span>; <span class="c"># 这个名字不知道干啥用的
</span>    <span class="n">root</span> /<span class="n">mnt</span>/<span class="n">d</span>/<span class="n">s</span>-<span class="n">linux</span>/<span class="n">project</span>/<span class="n">onebox</span>/<span class="n">server_frontend</span>/<span class="n">dist</span>;
    <span class="n">index</span> <span class="n">index</span>.<span class="n">html</span>;

    
    <span class="c"># 跨域转发
</span>    
    <span class="c"># location ~ /cloudapi/ {
</span>    <span class="c">#     # proxy_pass http://47.100.209.58:18080/api/; # 没加api也能访问成功？
</span>    <span class="c">#     proxy_pass http://47.100.209.58:18080;
</span>    <span class="c"># }
</span>
    <span class="n">location</span> /<span class="n">cloudapi</span>/ {
        <span class="n">proxy_pass</span> <span class="n">http</span>://<span class="m">47</span>.<span class="m">100</span>.<span class="m">209</span>.<span class="m">58</span>:<span class="m">18080</span>/<span class="n">api</span>/;
    }
    <span class="n">location</span> /<span class="n">isesol</span>/ {
        <span class="n">proxy_pass</span> <span class="n">http</span>://<span class="n">idis</span>.<span class="n">isesol</span>.<span class="n">com</span>/;
    }
}

</code></pre></div></div>]]></content><author><name></name></author><category term="bash" /><summary type="html"><![CDATA[简单介绍nginx 略]]></summary></entry><entry><title type="html">bash: init_codeserver 一键部署codeserver在ubuntu主机上</title><link href="/bash/init_codeserver/" rel="alternate" type="text/html" title="bash: init_codeserver 一键部署codeserver在ubuntu主机上" /><published>2023-06-29T14:10:00+08:00</published><updated>2023-06-29T14:10:00+08:00</updated><id>/bash/init_codeserver</id><content type="html" xml:base="/bash/init_codeserver/"><![CDATA[<ul>
  <li>简单介绍codeserver
    <ul>
      <li>略</li>
    </ul>
  </li>
  <li>脚本</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#! /bin/bash</span>

<span class="c"># ### - init_codeserver [code_server网页版vscode服务器]</span>
<span class="c"># - 脚本调用</span>
<span class="c"># ```setup.sh```</span>
<span class="c"># - 参数修改</span>
<span class="c">#     - 登录密码：/init_codeserver/setup.sh - sed (line27)</span>
<span class="c">#     - 默认端口：/init_codeserver/setup.sh - sed (line28)</span>
<span class="c">#     - 安装版本：/init_codeserver/setup.sh - version (line6)</span>
<span class="c"># - 注意</span>
<span class="c">#     - curl直接从github下载，可能无法访问</span>
<span class="c">#     - 默认下载amd64版本，在脚本中按需修改</span>
<span class="c">#     - 默认使用端口8081</span>
<span class="c">#     - code-server不能在vscode中启动，报错error Please specify at least one file or folder</span>

<span class="c"># # github官方仓库</span>
<span class="c"># https://github.com/coder/code-server/releases</span>


<span class="nv">version</span><span class="o">=</span><span class="s2">"4.6.0"</span> <span class="c"># 2022.8.21</span>
<span class="nv">package</span><span class="o">=</span><span class="s2">"code-server-</span><span class="nv">$version</span><span class="s2">-amd64.rpm"</span> <span class="c"># for wsl</span>
<span class="c"># package="code-server-$version-arm64.rpm" # for android termux / linux</span>
<span class="c"># package="code-server-$version-armhfp.rpm" # for raspberry pi (?)</span>
<span class="nv">port</span><span class="o">=</span>8081
<span class="nv">user</span><span class="o">=</span><span class="s2">"root"</span>

<span class="c"># 确认参数</span>
<span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">package select: </span><span class="nv">$package</span><span class="s2">"</span>
<span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"user: </span><span class="nv">$user</span><span class="s2">"</span>
<span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"port : </span><span class="nv">$port</span><span class="se">\n</span><span class="s2">press enter to continue..."</span>
<span class="nb">read</span> <span class="nt">-r</span> input



<span class="c"># 检查是否已经安装</span>
<span class="k">if</span> <span class="o">[</span> <span class="nt">-d</span> <span class="s2">"/</span><span class="nv">$user</span><span class="s2">/.config/code-server"</span> <span class="o">]</span><span class="p">;</span><span class="k">then
    </span><span class="nb">echo</span> <span class="s2">"code-server already installed"</span>
    <span class="nb">exit </span>1
<span class="k">fi</span>

<span class="c"># 创建.user_profile文件并写入.bashrc启动项</span>
<span class="k">if</span> <span class="o">[</span> <span class="o">!</span> <span class="nt">-e</span> ~/.user_profile <span class="o">]</span><span class="p">;</span><span class="k">then
    </span><span class="nb">touch</span> ~/.user_profile
<span class="k">else
    </span><span class="nb">echo</span> <span class="s2">"user_profile already exist"</span>
<span class="k">fi
if</span> <span class="o">!(</span> <span class="nb">cat</span> /<span class="nv">$user</span>/.bashrc | <span class="nb">grep</span> <span class="s2">"user_profile"</span> <span class="o">&gt;</span> /dev/null <span class="o">)</span><span class="p">;</span><span class="k">then
    </span><span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">echo 'setup command : ~/.user_profile'</span><span class="se">\n</span><span class="s2">"</span> <span class="o">&gt;&gt;</span> /<span class="nv">$user</span>/.bashrc
    <span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"if [ -f ~/.user_profile ]; then</span><span class="se">\n\t</span><span class="s2">. ~/.user_profile</span><span class="se">\n</span><span class="s2">fi"</span> <span class="o">&gt;&gt;</span> /<span class="nv">$user</span>/.bashrc
<span class="k">else
    </span><span class="nb">echo</span> <span class="s2">"user_profile already loaded in bashrc"</span>
<span class="k">fi</span>

<span class="c"># 下载rpm包并安装</span>
<span class="k">if</span> <span class="o">[</span> <span class="o">!</span> <span class="nt">-e</span> <span class="nv">$package</span> <span class="o">]</span><span class="p">;</span><span class="k">then
    </span>curl <span class="nt">-OL</span> https://github.com/coder/code-server/releases/download/v<span class="nv">$version</span>/<span class="nv">$package</span>
<span class="k">fi
</span>rpm <span class="nt">-ivh</span> <span class="nv">$package</span>
<span class="nb">rm</span> <span class="nv">$package</span>

<span class="c"># 首次运行生成config文件</span>
code-server <span class="o">&gt;</span> /dev/null 2&gt;&amp;1 &amp;
<span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"</span><span class="se">\n\n</span><span class="s2">sleep 5s, waiting for the end of the first operation ...</span><span class="se">\n\n</span><span class="s2">"</span>
<span class="nb">sleep </span>5
<span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">maybe done</span><span class="se">\n</span><span class="s2">"</span>
<span class="c"># 配置密码和端口，0.0.0.0代表本机所有ip地址</span>
<span class="nb">sed</span> <span class="nt">-i</span> <span class="s2">"/^password:*/cpassword: umas1970"</span> ~/.config/code-server/config.yaml
<span class="nb">sed</span> <span class="nt">-i</span> <span class="s2">"/^bind-addr:*/cbind-addr: 0.0.0.0:</span><span class="nv">$port</span><span class="s2">"</span> ~/.config/code-server/config.yaml



<span class="c"># 加入.user_profile启动项</span>
<span class="k">if</span> <span class="o">!(</span> <span class="nb">cat</span> /<span class="nv">$user</span>/.user_profile | <span class="nb">grep</span> <span class="s2">"user profile: code-server"</span> <span class="o">&gt;</span> /dev/null <span class="o">)</span><span class="p">;</span><span class="k">then
    </span><span class="nb">echo</span> <span class="s2">"# user profile: code-server"</span> <span class="o">&gt;&gt;</span> /<span class="nv">$user</span>/.user_profile
    <span class="nb">echo</span> <span class="s2">"echo ' * code-server port </span><span class="nv">$port</span><span class="s2"> starting ...'"</span> <span class="o">&gt;&gt;</span> /<span class="nv">$user</span>/.user_profile
    <span class="nb">echo</span> <span class="s2">"code-server &gt; /dev/null 2&gt;&amp;1 &amp;"</span> <span class="o">&gt;&gt;</span> /<span class="nv">$user</span>/.user_profile
    <span class="c"># echo "nohup code-server &amp;" &gt;&gt; /$user/.user_profile</span>
<span class="k">fi

</span><span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">code-server setup finish</span><span class="se">\n</span><span class="s2">"</span>


</code></pre></div></div>]]></content><author><name></name></author><category term="bash" /><summary type="html"><![CDATA[简单介绍codeserver 略]]></summary></entry><entry><title type="html">bash: init_apt 安装必备包，仿照py的requirements</title><link href="/bash/init_apt/" rel="alternate" type="text/html" title="bash: init_apt 安装必备包，仿照py的requirements" /><published>2023-06-29T14:04:00+08:00</published><updated>2023-06-29T14:04:00+08:00</updated><id>/bash/init_apt</id><content type="html" xml:base="/bash/init_apt/"><![CDATA[<ul>
  <li>仿照pip的requirements.txt创建apt_requirements.txt</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># 通过 apt install 安装的包
# 文档支持井号注释和空行，注释不要与包名放在同一行，结尾需要保留一行空行

python3
python3-pip
git
ssh
vim
curl
rpm

# systemctl安装报错使用aptitude install systemctl, aptitude需要额外安装
# aptitude
systemctl
</code></pre></div></div>

<ul>
  <li>脚本</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#! /bin/bash</span>

<span class="c"># ### - init_apt [apt软件包安装]</span>
<span class="c"># - 脚本调用  </span>
<span class="c"># ```./setup.sh```  </span>
<span class="c"># - 参数修改  </span>
<span class="c">#     - 添加新的包：/init_apt/apt_requirements.txt</span>

<span class="c"># 切换工作目录</span>
<span class="nb">cd</span> <span class="sb">`</span><span class="nb">dirname</span> <span class="nv">$0</span><span class="sb">`</span>

<span class="c"># apt 软件包安装</span>
<span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"</span><span class="se">\n</span><span class="s2"> ========== update ========== </span><span class="se">\n</span><span class="s2">"</span>
apt update
<span class="nb">cat</span> <span class="s1">'apt_requirements.txt'</span> | <span class="k">while </span><span class="nb">read </span>line
<span class="k">do
    if</span> <span class="o">[[</span> <span class="nv">$line</span> <span class="o">!=</span> <span class="s2">""</span> <span class="o">]]</span><span class="p">;</span><span class="k">then 
        if</span> <span class="o">[[</span> <span class="nv">$line</span> <span class="o">!=</span> <span class="k">*</span><span class="s2">"#"</span><span class="k">*</span> <span class="o">]]</span><span class="p">;</span><span class="k">then
            </span><span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"</span><span class="se">\n</span><span class="s2"> ========== install </span><span class="nv">$line</span><span class="s2"> ========== </span><span class="se">\n</span><span class="s2">"</span>
            apt <span class="nb">install</span> <span class="nv">$line</span> <span class="nt">-y</span>
        <span class="k">fi
    fi
done</span>

</code></pre></div></div>]]></content><author><name></name></author><category term="bash" /><summary type="html"><![CDATA[仿照pip的requirements.txt创建apt_requirements.txt ``` 通过 apt install 安装的包 文档支持井号注释和空行，注释不要与包名放在同一行，结尾需要保留一行空行]]></summary></entry><entry><title type="html">bash: init_alias 设置别名，加入.user_profile启动脚本</title><link href="/bash/init_alias/" rel="alternate" type="text/html" title="bash: init_alias 设置别名，加入.user_profile启动脚本" /><published>2023-06-29T14:00:00+08:00</published><updated>2023-06-29T14:00:00+08:00</updated><id>/bash/init_alias</id><content type="html" xml:base="/bash/init_alias/"><![CDATA[<ul>
  <li>alias基本语法示例（ubuntu）
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">alias </span><span class="nv">cdbox</span><span class="o">=</span><span class="s1">'cd /mnt/d/s-linux/project/onebox'</span>
</code></pre></div>    </div>
  </li>
  <li>脚本</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#! /bin/bash</span>

<span class="nv">user</span><span class="o">=</span><span class="s2">"root"</span>


<span class="c"># 确认参数</span>
<span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">user: </span><span class="nv">$user</span><span class="se">\n</span><span class="s2">press enter to continue..."</span>
<span class="nb">read</span> <span class="nt">-r</span> input


<span class="c"># 创建.user_profile文件并写入.bashrc启动项</span>
<span class="k">if</span> <span class="o">[</span> <span class="o">!</span> <span class="nt">-e</span> /<span class="nv">$user</span>/.user_profile <span class="o">]</span><span class="p">;</span><span class="k">then
    </span><span class="nb">touch</span> /<span class="nv">$user</span>/.user_profile
<span class="k">else
    </span><span class="nb">echo</span> <span class="s2">"user_profile already exist"</span>
<span class="k">fi
if</span> <span class="o">!(</span> <span class="nb">cat</span> /<span class="nv">$user</span>/.bashrc | <span class="nb">grep</span> <span class="s2">"user_profile"</span> <span class="o">&gt;</span> /dev/null <span class="o">)</span><span class="p">;</span><span class="k">then
    </span><span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">echo 'setup command : /</span><span class="nv">$user</span><span class="s2">/.user_profile'</span><span class="se">\n</span><span class="s2">"</span> <span class="o">&gt;&gt;</span> /<span class="nv">$user</span>/.bashrc
    <span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"if [ -f /</span><span class="nv">$user</span><span class="s2">/.user_profile ]; then</span><span class="se">\n\t</span><span class="s2">. /</span><span class="nv">$user</span><span class="s2">/.user_profile</span><span class="se">\n</span><span class="s2">fi"</span> <span class="o">&gt;&gt;</span> /<span class="nv">$user</span>/.bashrc
<span class="k">else
    </span><span class="nb">echo</span> <span class="s2">"user_profile already loaded in bashrc"</span>
<span class="k">fi</span>

<span class="c"># user_profile写入alias</span>
<span class="nv">cmd_arr</span><span class="o">=(</span><span class="s2">"alias cdbox='cd /mnt/d/s-linux/project/onebox'"</span> <span class="se">\</span>
        <span class="s2">"alias boxback='python3 run_backend.py'"</span> <span class="se">\</span>
        <span class="s2">""</span><span class="o">)</span>

<span class="k">for </span>cmd <span class="k">in</span> <span class="s2">"</span><span class="k">${</span><span class="nv">cmd_arr</span><span class="p">[@]</span><span class="k">}</span><span class="s2">"</span><span class="p">;</span><span class="k">do
    </span><span class="nb">echo</span> <span class="nv">$cmd</span>
    <span class="k">if</span> <span class="o">!(</span> <span class="nb">cat</span> /<span class="nv">$user</span>/.user_profile | <span class="nb">grep</span> <span class="s2">"</span><span class="nv">$cmd</span><span class="s2">"</span> <span class="o">&gt;</span> /dev/null <span class="o">)</span><span class="p">;</span><span class="k">then
        </span><span class="nb">echo</span> <span class="s2">"# alias"</span> <span class="o">&gt;&gt;</span> /<span class="nv">$user</span>/.user_profile
        <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$cmd</span><span class="s2">"</span> <span class="o">&gt;&gt;</span> /<span class="nv">$user</span>/.user_profile
    <span class="k">fi
done

</span><span class="nb">source</span> /<span class="nv">$user</span>/.bashrc

<span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">all done</span><span class="se">\n</span><span class="s2">"</span>

</code></pre></div></div>]]></content><author><name></name></author><category term="bash" /><summary type="html"><![CDATA[alias基本语法示例（ubuntu） alias cdbox='cd /mnt/d/s-linux/project/onebox']]></summary></entry><entry><title type="html">windows: huaweicloud hello_world 华为云服务器基本操作</title><link href="/windows/huaweicloud/" rel="alternate" type="text/html" title="windows: huaweicloud hello_world 华为云服务器基本操作" /><published>2023-06-29T11:00:00+08:00</published><updated>2023-06-29T11:00:00+08:00</updated><id>/windows/huaweicloud</id><content type="html" xml:base="/windows/huaweicloud/"><![CDATA[<ul>
  <li>启动nginx之后访问不到，telnet端口不同。</li>
  <li>需要在网站控制台上- 安全组 - 配置规则 - 添加出入方向规则</li>
</ul>

<p><img src="/image/windows/2023-06-29-huaweicloud/1.jpg" alt="引入图片" /></p>

<ul>
  <li>改完要reboot一下</li>
</ul>]]></content><author><name></name></author><category term="windows" /><summary type="html"><![CDATA[启动nginx之后访问不到，telnet端口不同。 需要在网站控制台上- 安全组 - 配置规则 - 添加出入方向规则]]></summary></entry><entry><title type="html">tampermonkey: next_page 键盘下一页</title><link href="/tampermonkey/next_page/" rel="alternate" type="text/html" title="tampermonkey: next_page 键盘下一页" /><published>2023-06-29T00:50:00+08:00</published><updated>2023-06-29T00:50:00+08:00</updated><id>/tampermonkey/next_page</id><content type="html" xml:base="/tampermonkey/next_page/"><![CDATA[<ul>
  <li>页面
    <ul>
      <li>https://www.101weiqi.cn/qday/2023/6/29/1/</li>
    </ul>
  </li>
  <li>查看元素发现这个按钮的实现方法还挺出乎意料的，是一个a标签</li>
</ul>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;span&gt;</span>
    <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"btn btn-info"</span> <span class="na">href=</span><span class="s">"/qday/2023/6/29/2/"</span><span class="nt">&gt;</span>下一题<span class="nt">&lt;/a&gt;</span>
<span class="nt">&lt;/span&gt;</span>
</code></pre></div></div>

<ul>
  <li>
    <p>页面url简单易懂，每日八题就是在日期后面拼接数字1~8，所以在油猴脚本里获取到当前页面url，拼接字符串再跳转就可以实现这个按钮的功能了</p>
  </li>
  <li>获取url
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>var url = window.location.href
</code></pre></div>    </div>
  </li>
  <li>获取末尾数字（字符串倒数第二项）
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>var page_num = url.charAt(url.length - 2);
</code></pre></div>    </div>
  </li>
  <li>按键监听</li>
</ul>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">document</span><span class="p">.</span><span class="nf">addEventListener</span><span class="p">(</span><span class="dl">"</span><span class="s2">keydown</span><span class="dl">"</span><span class="p">,</span> <span class="nf">function </span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span>
  <span class="kd">var</span> <span class="nx">page_num</span> <span class="o">=</span> <span class="nx">url</span><span class="p">.</span><span class="nf">charAt</span><span class="p">(</span><span class="nx">url</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span>
  <span class="c1">// 方向左键的键盘码是37</span>
  <span class="k">if </span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">keyCode</span> <span class="o">===</span> <span class="mi">37</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">上一页</span><span class="dl">"</span><span class="p">);</span>
    <span class="nf">change_page</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nf">parseInt</span><span class="p">(</span><span class="nx">page_num</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="c1">// 方向右键的键盘码是39</span>
  <span class="k">else</span> <span class="k">if </span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">keyCode</span> <span class="o">===</span> <span class="mi">39</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">下一页</span><span class="dl">"</span><span class="p">);</span>
    <span class="nf">change_page</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nf">parseInt</span><span class="p">(</span><span class="nx">page_num</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre></div></div>

<ul>
  <li>拼接新url：把url字符串的倒数第二位替换为新的页码
    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//倒数第二个字符之前的子字符串</span>
<span class="kd">var</span> <span class="nx">url_date</span> <span class="o">=</span> <span class="nx">url</span><span class="p">.</span><span class="nf">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">)</span>
<span class="c1">// 拼接新页码（最后的斜杠可以不加）</span>
<span class="kd">var</span> <span class="nx">url_new</span> <span class="o">=</span> <span class="nx">url_date</span> <span class="o">+</span> <span class="nx">page_num</span>
</code></pre></div>    </div>
  </li>
  <li>跳转到新链接
    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span> <span class="o">=</span> <span class="nx">url_new</span>
</code></pre></div>    </div>
  </li>
  <li>脚本的图标在这里</li>
</ul>

<p><img src="/image/tampermonkey/2023-6-29-next_page/image_1.jpg" alt="home" /></p>

<ul>
  <li>脚本完整代码</li>
</ul>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// ==UserScript==</span>
<span class="c1">// @name         键盘下一题</span>
<span class="c1">// @namespace    http://tampermonkey.net/</span>
<span class="c1">// @version      0.1</span>
<span class="c1">// @description  用键盘方向键来触发下一题按钮</span>
<span class="c1">// @author       umas</span>
<span class="c1">// @match        https://www.101weiqi.cn/qday/*</span>
<span class="c1">// @icon         https://static2.101weiqi.com/static/images/apple_1442.png</span>
<span class="c1">// @grant        none</span>
<span class="c1">// ==/UserScript==</span>


<span class="nb">document</span><span class="p">.</span><span class="nf">addEventListener</span><span class="p">(</span><span class="dl">"</span><span class="s2">keydown</span><span class="dl">"</span><span class="p">,</span> <span class="nf">function </span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span>
  <span class="kd">var</span> <span class="nx">page_num</span> <span class="o">=</span> <span class="nx">url</span><span class="p">.</span><span class="nf">charAt</span><span class="p">(</span><span class="nx">url</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span>
  <span class="c1">// 方向左键的键盘码是37</span>
  <span class="k">if </span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">keyCode</span> <span class="o">===</span> <span class="mi">37</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">上一页</span><span class="dl">"</span><span class="p">);</span>
    <span class="nf">change_page</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nf">parseInt</span><span class="p">(</span><span class="nx">page_num</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="c1">// 方向右键的键盘码是39</span>
  <span class="k">else</span> <span class="k">if </span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">keyCode</span> <span class="o">===</span> <span class="mi">39</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">下一页</span><span class="dl">"</span><span class="p">);</span>
    <span class="nf">change_page</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nf">parseInt</span><span class="p">(</span><span class="nx">page_num</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="kd">function</span> <span class="nf">change_page</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span><span class="nx">page_num</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">page_num</span> <span class="o">==</span><span class="mi">0</span> <span class="o">||</span> <span class="nx">page_num</span> <span class="o">==</span> <span class="mi">9</span><span class="p">){</span>
        <span class="k">return</span>
    <span class="p">}</span>
    <span class="kd">var</span> <span class="nx">url_date</span> <span class="o">=</span> <span class="nx">url</span><span class="p">.</span><span class="nf">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">)</span>
    <span class="kd">var</span> <span class="nx">url_new</span> <span class="o">=</span> <span class="nx">url_date</span> <span class="o">+</span> <span class="nx">page_num</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span> <span class="o">=</span> <span class="nx">url_new</span>
<span class="p">}</span>
</code></pre></div></div>]]></content><author><name></name></author><category term="tampermonkey" /><summary type="html"><![CDATA[页面 https://www.101weiqi.cn/qday/2023/6/29/1/]]></summary></entry></feed>